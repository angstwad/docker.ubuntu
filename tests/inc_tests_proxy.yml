---
- name: Common tests for all supported OSes
  hosts:
    - ubuntu1204
#     - ubuntu1404
#     - ubuntu1604
#     - debian
  tasks:
    - name: Test if HTTP_PROXY environment variable not set
      debug:
        msg: "HTTP_PROXY was set to {{ ansible_env.HTTP_PROXY }}" 
#       fail:
#         msg: "HTTP_PROXY env variable is {{ ansible_env.HTTP_PROXY }} instead of ..."
#       when: (ansible_env.HTTP_PROXY != "http://foo.bar.com:3128") or
#             (ansible_env.HTTP_PROXY is undefined) or 
#             (ansible_env.HTTP_PROXY is none) or 
#             (ansible_env.HTTP_PROXY | trim == '')

- name: Ubuntu 1604 specific tests
  hosts: ubuntu1604
  tasks:
    - name: Tests if http-proxy.conf exists.
      stat: 
        path: /etc/systemd/system/docker.service.d/http-proxy.conf
      register: docker_systemd_file
    - fail:
        msg: "/etc/systemd/system/docker.service.d/http-proxy.conf missing"
      when: not docker_systemd_file.stat.exists